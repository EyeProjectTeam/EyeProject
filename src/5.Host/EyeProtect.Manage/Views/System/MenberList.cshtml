@{
    ViewData["Title"] = "Eye后台管理";
    ViewData["Tabs"] = "账号管理";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<div class="wrap-container clearfix">
    <div class="column-content-detail">
        <form class="layui-form" action="">
            <div class="layui-form-item">
                <div class="layui-inline tool-btn">
                    <div class="layui-btn" id="export">
                        <i class="layui-icon layui-icon-export"></i>
                    </div>
                </div>
                <div class="layui-inline">
                    <input type="text" name="account" placeholder="请输入账号" autocomplete="off" class="layui-input">
                </div>
                <div class="layui-inline">
                    <select name="states" lay-filter="status">
                        <option value="">请选择一个状态</option>
                        <option value="0">已使用</option>
                        <option value="1">已过期</option>
                        <option value="2">未使用</option>
                        <option value="3">未出售</option>
                    </select>
                </div>
                <button class="layui-btn layui-btn-normal" lay-submit="search" id="search">搜索</button>
            </div>
        </form>
        <div class="layui-form" id="table-list">
            <table id="accountList" lay-filter="test">
            </table>
        </div>
    </div>
</div>

<script type="text/javascript">
    layui.use('table', function () {
        var table = layui.table;

        table.render({
            elem: '#accountList',
            height: 650,
            limit: 20,
            url: baseUrl + '/Account/MemberPageList', //数据接口
            request: {
                pageName: 'pageIndex', //页码的参数名称，默认：page
                limitName: 'pageSize' //每页数据量的参数名，默认：limit
            },
            response: {
                msgName: 'message', //规定状态信息的字段名称，默认：msg
                countName: 'totalCount', //规定数据总数的字段名称，默认：count
            },
            page: true, //开启分页
            cols: [[ //表头
                { field: 'id', title: 'ID', width: 80, sort: true, fixed: 'left' },
                { field: 'account', title: '账号', sort: true },
                { field: 'password', title: '密码', },
                { field: 'accountTypeMsg', title: '使用情况', templet: '#accountTypeMsgTpl' }
            ]]
        });

    });

</script>

<script type="text/html" id="accountTypeMsgTpl">
     {{#  if(d.accountTypeMsg == '已使用'){ }}
      <button class="layui-btn layui-btn-mini layui-btn">{{d.accountTypeMsg}}</button>
    {{#  } else if(d.accountTypeMsg == '已过期'){ }}
      <button class="layui-btn layui-btn-mini layui-btn-danger">{{d.accountTypeMsg}}</button>
    {{#  } else if(d.accountTypeMsg == '未使用'){ }}
      <button class="layui-btn layui-btn-mini layui-btn-normal">{{d.accountTypeMsg}}</button>
    {{#  } else if(d.accountTypeMsg == '未出售'){ }}
      <button class="layui-btn layui-btn-mini layui-btn-warm">{{d.accountTypeMsg}}</button>
    {{#  } }}
</script>

<script type="text/javascript">
    var account = $("input[name='account']").val();
    var accountType = $("select[name='states'] option:selected").val();

    $('#search').on('click', a = function () {
        table.reload("accountList", {
            page: {
                curr: 1 //重新从第 1 页开始
            }
            , where: {
                account: account == null ? "" : account,
                accountType: accountType == "" ? "" : accountType,
            }
        });
    });

    $('#search').on('click', function () {
        var url = baseUrl + "/Account/ExportMemberList";
        var f1 = $.ajax({
            url: url,
            type: 'post',
            xhrFields: {
                responseType: 'blob'
            },
        });
        $.when(f1).then(function (content) {
            console.log("jinru")
            var filename = 'xxx.' + url.replace(/(.*\.)/, '') // 自定义文件名+后缀
            var a = document.createElement('a')
            var blob = new Blob([content])
            var url = window.URL.createObjectURL(blob)
            a.href = url
            a.download = filename
            a.click()
            window.URL.revokeObjectURL(url)
        }, function () {
            //失败回调，任意一个请求失败时返回
            console.log("失败");
            console.log('error');
        })
    });
</script>